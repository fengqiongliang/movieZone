<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.moviezone.dao.MovieDao" >
  <resultMap id="movieResultMap" type="com.moviezone.domain.Movie" >
    <id column="movieid" property="movieid" jdbcType="BIGINT" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="type" property="type" jdbcType="VARCHAR" />
    <result column="shortdesc" property="shortdesc" jdbcType="VARCHAR" />
    <result column="longdesc" property="longdesc" jdbcType="VARCHAR" />
    <result column="face650x500" property="face650x500" jdbcType="VARCHAR" />
    <result column="face220x169" property="face220x169" jdbcType="VARCHAR" />
    <result column="face150x220" property="face150x220" jdbcType="VARCHAR" />
    <result column="face80x80" property="face80x80" jdbcType="VARCHAR" />
    <result column="picture" property="picture" jdbcType="VARCHAR" />
    <result column="score" property="score" jdbcType="FLOAT" />
    <result column="approve" property="approve" jdbcType="INTEGER" />
    <result column="favorite" property="favorite" jdbcType="INTEGER" />
    <result column="download" property="download" jdbcType="INTEGER" />
    <result column="broswer" property="broswer" jdbcType="INTEGER" />
    <result column="createtime" property="createtime" jdbcType="TIMESTAMP" />
    <result column="publishtime" property="publishtime" jdbcType="TIMESTAMP" />
    <collection column="movieid" property="attachs"  ofType="com.moviezone.domain.Attach"  javaType="ArrayList"  select="selectAttach"  fetchType="lazy" />
  </resultMap>
  <resultMap id="attachResultMap" type="com.moviezone.domain.Attach" >
    <id column="attachid" property="attachid" jdbcType="BIGINT" />
    <result column="movieid" property="movieid" jdbcType="BIGINT" />
    <result column="new_name" property="new_name" jdbcType="VARCHAR" />
    <result column="old_name" property="old_name" jdbcType="VARCHAR" />
    <result column="attach_url" property="attach_url" jdbcType="VARCHAR" />
    <result column="createtime" property="createtime" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <sql id="movieColumns" >
    movieid, name,type,shortdesc,longdesc,face650x500,face220x169,face150x220,face80x80,picture,score,approve,favorite,download,broswer,createtime,publishtime
  </sql>
  <sql id="selectMovieIFCol">
  	<if test="movieid >0">  and movieid = #{movieid,jdbcType=BIGINT} </if>
    <if test="name != null">  and name = #{name,jdbcType=VARCHAR} </if>
    <if test="type != null">  and type = #{type,jdbcType=VARCHAR} </if>
    <if test="shortdesc != null"> and shortdesc = #{shortdesc,jdbcType=VARCHAR} </if>
    <if test="longdesc != null"> and longdesc = #{longdesc,jdbcType=VARCHAR} </if>
    <if test="face650x500 != null"> and face650x500 = #{face650x500,jdbcType=VARCHAR} </if>
    <if test="face220x169 != null"> and face220x169 = #{face220x169,jdbcType=VARCHAR} </if>
    <if test="face150x220 != null"> and face150x220 = #{face150x220,jdbcType=VARCHAR} </if>
    <if test="face80x80 != null"> and face80x80 = #{face80x80,jdbcType=VARCHAR} </if>
    <if test="picture != null"> and picture = #{picture,jdbcType=VARCHAR} </if>
    <if test="score > 0"> and score = #{score,jdbcType=FLOAT} </if>
    <if test="approve > 0"> and approve = #{approve,jdbcType=INTEGER} </if>
    <if test="favorite  > 0"> and favorite = #{favorite,jdbcType=INTEGER} </if>
    <if test="download  > 0"> and download = #{download,jdbcType=INTEGER} </if>
    <if test="broswer >0 "> and broswer = #{broswer,jdbcType=INTEGER} </if>
    <if test="createtime != null"> and createtime = #{createtime,jdbcType=TIMESTAMP} </if>
    <if test="publishtime != null"> and publishtime = #{publishtime,jdbcType=TIMESTAMP} </if>
  </sql>
  
  <select id="selectMovieCount" resultType="map" parameterType="map"  >
    select 'false' as QUERYID, 
    count(movieid) as total
    from movie where 1=1 
    <include refid="selectMovieIFCol" />
  </select>
  
  <select id="selectMovie" resultMap="movieResultMap" parameterType="map"  >
    select 'false' as QUERYID, 
    <include refid="movieColumns" /> 
    from movie where 1=1 
    <include refid="selectMovieIFCol" />
    limit #{start,jdbcType=INTEGER},#{size,jdbcType=INTEGER}
  </select>
  
  <select id="selectAttach" resultMap="attachResultMap" parameterType="com.moviezone.domain.Attach"  >
    select 'false' as QUERYID, attachid,movieid,new_name,old_name,attach_url,createtime from attachment where movieid = #{movieid,jdbcType=BIGINT}
  </select>
  
  <insert id="insertMovie" parameterType="com.moviezone.domain.Movie" >
    insert into movie
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="movieid >0" >movieid,</if>
      <if test="name != null" >name,</if>
      <if test="type != null" >type,</if>
      <if test="shortdesc != null" >shortdesc,</if>
      <if test="longdesc != null">longdesc,</if>
      <if test="face650x500 != null" >face650x500,</if>
      <if test="face220x169 != null" >face220x169,</if>
      <if test="face150x220 != null" >face150x220,</if>
      <if test="face80x80 != null" >face80x80,</if>
      <if test="picture != null" >picture,</if>
      <if test="score != null" >score,</if>
      <if test="approve != null" >approve,</if>
      <if test="favorite != null" >favorite,</if>
      <if test="download != null" >download,</if>
      <if test="broswer != null" >broswer,</if>
      <if test="publishtime != null" >publishtime,</if>
      createtime
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="movieid >0" >#{movieid,jdbcType=BIGINT},</if>
      <if test="name != null" >#{name,jdbcType=VARCHAR},</if>
      <if test="type != null" >#{type,jdbcType=VARCHAR},</if>
      <if test="shortdesc != null" >#{shortdesc,jdbcType=VARCHAR},</if>
      <if test="longdesc != null">#{longdesc,jdbcType=VARCHAR}</if>
      <if test="face650x500 != null" >#{face650x500,jdbcType=VARCHAR},</if>
      <if test="face220x169 != null" >#{face220x169,jdbcType=VARCHAR},</if>
      <if test="face150x220 != null" >#{face150x220,jdbcType=VARCHAR},</if>
      <if test="face80x80 != null" >#{face80x80,jdbcType=VARCHAR},</if>
      <if test="picture != null" >#{picture,jdbcType=VARCHAR},</if>
      <if test="score != null" >#{score,jdbcType=VARCHAR},</if>
      <if test="approve != null" >#{approve,jdbcType=VARCHAR},</if>
      <if test="favorite != null" >#{favorite,jdbcType=VARCHAR},</if>
      <if test="download != null" >#{download,jdbcType=VARCHAR},</if>
      <if test="broswer != null" >#{broswer,jdbcType=VARCHAR},</if>
      <if test="publishtime != null" >#{publishtime,jdbcType=TIMESTAMP},</if>
      sysdate()
    </trim>
  </insert>
    
  <update id="updateMovie" parameterType="com.moviezone.domain.Movie" >
    update movie
    <set>
      <if test="name != null" >name = #{name,jdbcType=VARCHAR},</if>
      <if test="type != null" >type = #{type,jdbcType=VARCHAR},</if>
      <if test="shortdesc != null" >shortdesc = #{shortdesc,jdbcType=VARCHAR},</if>
      <if test="longdesc != null">longdesc = #{longdesc,jdbcType=VARCHAR}</if>
      <if test="face650x500 != null" >face650x500 = #{face650x500,jdbcType=VARCHAR},</if>
      <if test="face220x169 != null" >face220x169 = #{face220x169,jdbcType=VARCHAR},</if>
      <if test="face150x220 != null" >face150x220 = #{face150x220,jdbcType=VARCHAR},</if>
      <if test="face80x80 != null" >face80x80 = #{face80x80,jdbcType=VARCHAR},</if>
      <if test="picture != null" >picture = #{picture,jdbcType=VARCHAR},</if>
      <if test="score != null" >score = #{score,jdbcType=VARCHAR},</if>
      <if test="approve != null" >approve = #{approve,jdbcType=VARCHAR},</if>
      <if test="favorite != null" >favorite = #{favorite,jdbcType=VARCHAR},</if>
      <if test="download != null" >download = #{download,jdbcType=VARCHAR},</if>
      <if test="broswer != null" >broswer = #{broswer,jdbcType=VARCHAR},</if>
      <if test="publishtime != null" >publishtime = #{publishtime,jdbcType=TIMESTAMP},</if>
    </set>
    where movieid = #{movieid,jdbcType=BIGINT}
  </update>
  
  <delete id="deleteMovie" parameterType="com.moviezone.domain.Movie" >
    delete from movie where movieid = #{movieid,jdbcType=BIGINT}
  </delete>
  
</mapper>